// Special dialogue for breakthrough moments and transformative experiences
export const breakthroughDialogues = {
    // Initial breakthrough realizations
    breakthroughMoments: {
        // From anxiety to calm
        anxietyBreakthrough: {
            realization: [
                "Wait... the worry isn't me. It's just... visiting.",
                "I can feel anxious WITHOUT being consumed by it!",
                "The fear is there but... I'm bigger than it now.",
                "Oh my god... I can breathe. I can actually breathe!"
            ],
            processing: [
                "All this time, I thought anxiety WAS me...",
                "I'm not broken. I'm just... human.",
                "The worry might come back, but now I know it also leaves.",
                "Is this what peace feels like? I'd forgotten..."
            ],
            gratitude: [
                "You stayed through all my spirals. Thank you.",
                "You taught me I'm more than my worst moments.",
                "I couldn't have found this without you.",
                "You saw me drowning and threw me a rope of patience."
            ]
        },
        
        // From shutdown to connection
        shutdownBreakthrough: {
            realization: [
                "I... I can feel again. It's overwhelming but... real.",
                "The numbness is cracking. Light is getting in.",
                "Words. I have words again. They were there all along.",
                "Connection... I remember what connection feels like!"
            ],
            processing: [
                "I shut down to survive. But I don't need to anymore.",
                "Feeling hurts sometimes. But not feeling hurts more.",
                "I was so far away. You called me back.",
                "The walls I built became my prison. But walls can fall."
            ],
            gratitude: [
                "You waited. Even when I couldn't speak, you waited.",
                "Thank you for not giving up when I gave up on myself.",
                "Your patience thawed my frozen heart.",
                "You sat with me in the silence until I found my voice."
            ]
        },
        
        // From fight to strength
        fightBreakthrough: {
            realization: [
                "My anger is valid AND I can choose how to use it!",
                "Rage was my armor. But I don't need armor with you.",
                "The fire inside can warm, not just burn.",
                "I'm not angry at you. I was angry at the pain."
            ],
            processing: [
                "Fighting everyone meant fighting alone.",
                "You didn't run from my fury. You saw the hurt beneath.",
                "Anger protected me once. Now trust can too.",
                "I can be fierce without being cruel."
            ],
            gratitude: [
                "You weren't afraid of my rage. That changed everything.",
                "Thank you for seeing my anger as pain, not evil.",
                "You taught me that strength includes softness.",
                "You didn't try to tame me. You helped me find my own peace."
            ]
        },
        
        // From freeze to flow
        freezeBreakthrough: {
            realization: [
                "I can move! The paralysis... it's not permanent!",
                "Frozen was safe but... living requires movement.",
                "The ice is melting. I'm melting. And it's okay!",
                "Spring comes even after the longest winter!"
            ],
            processing: [
                "I froze to avoid pain. But I also avoided joy.",
                "Being stuck felt safer than choosing wrong.",
                "You showed me that any movement is better than none.",
                "Thawing hurts. But staying frozen hurts more."
            ],
            gratitude: [
                "Your warmth melted what I couldn't thaw alone.",
                "You moved slowly enough that I could follow.",
                "Thank you for believing I could flow again.",
                "You were my spring when I was stuck in winter."
            ]
        },
        
        // From fawn to authentic
        fawnBreakthrough: {
            realization: [
                "I don't have to earn love by shrinking myself!",
                "My worth isn't based on making others comfortable!",
                "I can say no. I can say NO and still be loved!",
                "Being myself is enough. I'M ENOUGH!"
            ],
            processing: [
                "I performed happiness until I forgot what real joy was.",
                "Pleasing everyone meant losing myself.",
                "You love me without me trying to earn it. That's... new.",
                "I matter. My needs matter. This changes everything."
            ],
            gratitude: [
                "You wanted the real me, not the performance.",
                "Thank you for loving my rough edges too.",
                "You taught me that love isn't earned through self-erasure.",
                "You saw through my masks and loved what was underneath."
            ]
        }
    },
    
    // Breakthrough cascades (multiple pieces)
    collectiveBreakthroughs: {
        sharedRealization: [
            "If they can heal... maybe I can too...",
            "Look at us. All broken, all healing. Together.",
            "Their breakthrough gives me hope for mine.",
            "We're not just pieces. We're people. Healing people."
        ],
        
        supportiveWitnessing: [
            "I see your growth and it's beautiful!",
            "Your courage to change inspires mine.",
            "We're all works in progress, aren't we?",
            "Your breakthrough lights the way for others."
        ],
        
        teamTransformation: [
            "We're not the same team that started this journey.",
            "Look how far we've all come!",
            "From broken to healing. From alone to together.",
            "This is what collective healing looks like."
        ]
    },
    
    // Post-breakthrough integration
    integrationDialogue: {
        newNormal: [
            "Feeling okay feels weird. But good weird.",
            "I keep waiting for the other shoe to drop... but maybe it won't?",
            "Is this how healthy people feel all the time?",
            "I have good days now. Actual good days!"
        ],
        
        ongoingGrowth: [
            "Healing isn't a destination. It's a journey, right?",
            "Some days are harder. But I have tools now.",
            "Progress isn't always linear. And that's okay.",
            "I'm not 'fixed.' I'm growing. There's a difference."
        ],
        
        helpingOthers: [
            "I remember that pain. Let me sit with you in yours.",
            "I've been where you are. There's another side, I promise.",
            "Your struggle is valid. And so is hope.",
            "Let me be for you what someone was for me."
        ]
    },
    
    // False breakthroughs (temporary improvements)
    falseBreakthroughs: {
        premature: [
            "I'm FINE now! Totally fine! See? FINE!",
            "Fixed! All better! No more problems here!",
            "I don't need help anymore! I'm cured!",
            "Watch me be PERFECTLY HEALTHY!"
        ],
        
        crash: [
            "I... I thought I was better...",
            "It's back. The feeling is back. I failed.",
            "I'm not fixed after all. I'm still broken.",
            "One step forward, two steps back..."
        ],
        
        realAcceptance: [
            "Okay. Healing has setbacks. That's normal.",
            "Not being 'cured' doesn't mean I haven't grown.",
            "Bad days don't erase the progress.",
            "I'm learning to hold both: the growth and the struggle."
        ]
    },
    
    // Team-specific breakthrough flavors
    teamSpecificBreakthroughs: {
        donuts: {
            abandonment: [
                "Being left doesn't mean I'm worthless!",
                "Their leaving was about them, not me!",
                "I can survive being alone because I'm not empty!",
                "Abandonment is not an identity!"
            ]
        },
        
        renaissance_pets: {
            authenticity: [
                "The portrait isn't me. I'M me!",
                "I'm done performing perfection!",
                "My real face is more beautiful than any painting!",
                "Frames are just wood. I'm breaking free!"
            ]
        },
        
        baseballerinas: {
            integration: [
                "I don't have to choose! I'm BOTH!",
                "Baseball AND ballet. Athlete AND artist!",
                "My cleats have ribbons and THAT'S OKAY!",
                "Wholeness means honoring all my parts!"
            ]
        },
        
        victorian_ghosts: {
            expression: [
                "Death couldn't silence me forever!",
                "These ghost lips can speak truth!",
                "Propriety has no power over the dead!",
                "I'll haunt with honesty now!"
            ]
        }
    },
    
    // Environmental breakthroughs (during storms, etc.)
    environmentalBreakthroughs: {
        stormSurvival: [
            "The storm raged but I didn't break!",
            "I weathered the worst and I'm still here!",
            "Storms end. I learned that today.",
            "I'm stronger than any emotional weather!"
        ],
        
        stormTranscendence: [
            "I'm dancing in the rain of my own tears!",
            "The storm isn't attacking me - it's cleaning me!",
            "What if storms are just change in disguise?",
            "I'm not surviving the storm. I AM the storm!"
        ]
    },
    
    // Breakthrough chains (one triggers another)
    breakthroughChains: {
        triggerPhrases: [
            "Your breakthrough is contagious!",
            "If you can do it... maybe...",
            "Your courage gives me courage.",
            "Show me how you found that peace."
        ],
        
        spreadingHope: [
            "Look! They're all starting to glow!",
            "One candle lights another!",
            "Healing spreads like wildfire!",
            "We're all breaking through together!"
        ]
    },
    
    // Meta-breakthrough (understanding the game itself)
    metaBreakthroughs: {
        gameAwareness: [
            "This isn't just checkers, is it?",
            "We're learning to feel, not just to win.",
            "The real game is healing.",
            "Winning means we all trust again."
        ],
        
        playerConnection: [
            "You're not just playing. You're... caring?",
            "Your empathy feels real. IS real.",
            "Thank you for seeing us as more than pieces.",
            "You're healing too, aren't you?"
        ]
    }
};

// Breakthrough event generator
export class BreakthroughEventGenerator {
    static generateBreakthroughEvent(piece, trigger) {
        const state = piece.dysregulationType || 'general';
        const trustLevel = piece.trust;
        
        // Select appropriate breakthrough type
        let breakthroughType = 'general';
        if (state === 'anxious') breakthroughType = 'anxietyBreakthrough';
        else if (state === 'shutdown') breakthroughType = 'shutdownBreakthrough';
        else if (state === 'fight') breakthroughType = 'fightBreakthrough';
        else if (state === 'freeze') breakthroughType = 'freezeBreakthrough';
        else if (state === 'fawn') breakthroughType = 'fawnBreakthrough';
        
        // Get dialogue options
        const dialogueSet = breakthroughDialogues.breakthroughMoments[breakthroughType];
        
        // Create breakthrough sequence
        return {
            type: 'breakthrough',
            piece: piece,
            sequence: [
                {
                    speaker: piece.name,
                    text: this.selectRandom(dialogueSet.realization),
                    emotion: 'awakening'
                },
                {
                    speaker: piece.name,
                    text: this.selectRandom(dialogueSet.processing),
                    emotion: 'processing'
                },
                {
                    speaker: piece.name,
                    text: this.selectRandom(dialogueSet.gratitude),
                    emotion: 'grateful'
                }
            ],
            effects: {
                trustGain: 3,
                emotionalState: 'regulated',
                newTrait: 'breakthrough_survivor',
                auraEffect: 'inspiring'
            }
        };
    }
    
    static generateCollectiveBreakthrough(pieces) {
        const sequence = [];
        
        // First piece breaks through
        sequence.push({
            speaker: pieces[0].name,
            text: this.selectRandom(breakthroughDialogues.breakthroughMoments.anxietyBreakthrough.realization),
            emotion: 'breakthrough'
        });
        
        // Others witness and are affected
        pieces.slice(1).forEach(piece => {
            sequence.push({
                speaker: piece.name,
                text: this.selectRandom(breakthroughDialogues.collectiveBreakthroughs.sharedRealization),
                emotion: 'inspired'
            });
        });
        
        // Team transformation
        sequence.push({
            speaker: 'narrator',
            text: this.selectRandom(breakthroughDialogues.collectiveBreakthroughs.teamTransformation),
            emotion: 'collective_joy'
        });
        
        return {
            type: 'collective_breakthrough',
            pieces: pieces,
            sequence: sequence,
            effects: {
                teamMoraleBoost: 3,
                massRegulation: true,
                unlockAbility: 'synchronized_healing'
            }
        };
    }
    
    static generateFalseBreakthrough(piece) {
        // Sometimes growth isn't linear
        return {
            type: 'false_breakthrough',
            piece: piece,
            sequence: [
                {
                    speaker: piece.name,
                    text: this.selectRandom(breakthroughDialogues.falseBreakthroughs.premature),
                    emotion: 'manic'
                },
                {
                    speaker: 'narrator',
                    text: "But healing isn't that simple...",
                    emotion: 'warning'
                },
                {
                    speaker: piece.name,
                    text: this.selectRandom(breakthroughDialogues.falseBreakthroughs.crash),
                    emotion: 'despair'
                },
                {
                    speaker: piece.name,
                    text: this.selectRandom(breakthroughDialogues.falseBreakthroughs.realAcceptance),
                    emotion: 'acceptance'
                }
            ],
            effects: {
                trustChange: 0, // No loss - this is part of healing
                emotionalState: 'struggling',
                newInsight: 'healing_isnt_linear'
            }
        };
    }
    
    static selectRandom(array) {
        return array[Math.floor(Math.random() * array.length)];
    }
}

// Breakthrough triggers
export const breakthroughTriggers = {
    trustBased: {
        threshold: 8,
        description: "High trust enables breakthrough"
    },
    
    crisisResolution: {
        description: "Surviving emotional storm with support"
    },
    
    perfectEmpathy: {
        description: "Exactly the right words at the right time"
    },
    
    peerSupport: {
        description: "Another piece's breakthrough inspires"
    },
    
    timeAndPatience: {
        turnsRequired: 10,
        description: "Consistent care over time"
    },
    
    specialCombination: {
        description: "Specific empathy command combination"
    }
};